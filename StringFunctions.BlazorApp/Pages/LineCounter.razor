@page "/line-counter"

<PageTitle>Line Counter</PageTitle>

<ToolPageLayout Title="Line Counter" Description="View text statistics: lines, words, characters, and more.">
    <ChildContent>
        <div class="line-counter-layout">
            <div class="input-section io-panel">
                <div class="io-panel-header">
                    <span class="io-panel-title">Input</span>
                </div>
                <FluentTextArea @bind-Value="@inputText" 
                               Placeholder="Enter text to analyze..."
                               Resize="TextAreaResize.Vertical"
                               @oninput="OnInputChanged" />
            </div>

            <div class="stats-section">
                <h3 class="stats-title">Statistics</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-value">@stats.Lines</span>
                        <span class="stat-label">Lines</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value">@stats.NonEmptyLines</span>
                        <span class="stat-label">Non-empty Lines</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value">@stats.Words</span>
                        <span class="stat-label">Words</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value">@stats.Characters</span>
                        <span class="stat-label">Characters</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value">@stats.CharactersNoSpaces</span>
                        <span class="stat-label">Characters (no spaces)</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value">@stats.Bytes</span>
                        <span class="stat-label">Bytes (UTF-8)</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value">@stats.Paragraphs</span>
                        <span class="stat-label">Paragraphs</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value">@stats.Sentences</span>
                        <span class="stat-label">Sentences</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value">@stats.AvgWordLength</span>
                        <span class="stat-label">Avg. Word Length</span>
                    </div>
                </div>
            </div>
        </div>
    </ChildContent>
</ToolPageLayout>

<style>
    .line-counter-layout {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
    }

    .input-section {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .io-panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .io-panel-title {
        font-weight: 600;
        font-size: 0.9rem;
        color: var(--text-primary);
    }

    .stats-section {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 16px;
    }

    .stats-title {
        margin: 0 0 16px 0;
        font-size: 1rem;
        color: var(--text-primary);
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
    }

    .stat-card {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        padding: 12px;
        text-align: center;
    }

    .stat-value {
        display: block;
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--accent-primary);
    }

    .stat-label {
        display: block;
        font-size: 0.75rem;
        color: var(--text-secondary);
        margin-top: 4px;
    }

    @@media (max-width: 768px) {
        .line-counter-layout {
            grid-template-columns: 1fr;
        }
        
        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }
</style>

@code {
    private string inputText = string.Empty;
    private TextStatistics stats = new();

    private void OnInputChanged(ChangeEventArgs e)
    {
        inputText = e.Value?.ToString() ?? string.Empty;
        CalculateStats();
    }

    private void CalculateStats()
    {
        if (string.IsNullOrEmpty(inputText))
        {
            stats = new TextStatistics();
            return;
        }

        var lines = inputText.Split('\n');
        var words = inputText.Split(new[] { ' ', '\n', '\r', '\t' }, StringSplitOptions.RemoveEmptyEntries);
        var sentences = inputText.Split(new[] { '.', '!', '?' }, StringSplitOptions.RemoveEmptyEntries);
        var paragraphs = inputText.Split(new[] { "\n\n", "\r\n\r\n" }, StringSplitOptions.RemoveEmptyEntries);

        stats = new TextStatistics
        {
            Lines = lines.Length,
            NonEmptyLines = lines.Count(l => !string.IsNullOrWhiteSpace(l)),
            Words = words.Length,
            Characters = inputText.Length,
            CharactersNoSpaces = inputText.Count(c => !char.IsWhiteSpace(c)),
            Bytes = System.Text.Encoding.UTF8.GetByteCount(inputText),
            Paragraphs = paragraphs.Length,
            Sentences = sentences.Length,
            AvgWordLength = words.Any() ? Math.Round(words.Average(w => w.Length), 1) : 0
        };
    }

    private class TextStatistics
    {
        public int Lines { get; set; }
        public int NonEmptyLines { get; set; }
        public int Words { get; set; }
        public int Characters { get; set; }
        public int CharactersNoSpaces { get; set; }
        public int Bytes { get; set; }
        public int Paragraphs { get; set; }
        public int Sentences { get; set; }
        public double AvgWordLength { get; set; }
    }
}
