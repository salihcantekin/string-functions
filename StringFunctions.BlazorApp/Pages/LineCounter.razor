@page "/line-counter"

<PageTitle>Line Counter</PageTitle>

<FluentStack Orientation="Orientation.Vertical" Style="gap: 20px;">
    <FluentCard Style="padding: 20px;">
        <FluentLabel Typo="Typography.H3">Line Counter</FluentLabel>
        <FluentLabel Typo="Typography.Body">Metin istatistiklerini görüntüleyin: satır, kelime, karakter sayısı ve daha fazlası.</FluentLabel>
    </FluentCard>

    <FluentCard Style="padding: 20px;">
        <FluentStack Orientation="Orientation.Vertical" Style="gap: 12px;">
            <FluentLabel Typo="Typography.H5">Giriş</FluentLabel>
            <FluentTextArea @bind-Value="@inputText" 
                           Placeholder="Analiz edilecek metni girin..."
                           Rows="15"
                           Style="width: 100%;"
                           @oninput="OnInputChanged" />
        </FluentStack>
    </FluentCard>

    <FluentCard Style="padding: 20px;">
        <FluentStack Orientation="Orientation.Vertical" Style="gap: 16px;">
            <FluentLabel Typo="Typography.H5">İstatistikler</FluentLabel>
            
            <FluentGrid Spacing="3">
                <FluentGridItem xs="12" sm="6" md="4">
                    <FluentCard Style="padding: 16px; background: var(--neutral-layer-2); text-align: center;">
                        <FluentLabel Typo="Typography.H4" Style="color: var(--accent-fill-rest);">@stats.Lines</FluentLabel>
                        <FluentLabel Typo="Typography.Body">Satır</FluentLabel>
                    </FluentCard>
                </FluentGridItem>

                <FluentGridItem xs="12" sm="6" md="4">
                    <FluentCard Style="padding: 16px; background: var(--neutral-layer-2); text-align: center;">
                        <FluentLabel Typo="Typography.H4" Style="color: var(--accent-fill-rest);">@stats.NonEmptyLines</FluentLabel>
                        <FluentLabel Typo="Typography.Body">Boş Olmayan Satır</FluentLabel>
                    </FluentCard>
                </FluentGridItem>

                <FluentGridItem xs="12" sm="6" md="4">
                    <FluentCard Style="padding: 16px; background: var(--neutral-layer-2); text-align: center;">
                        <FluentLabel Typo="Typography.H4" Style="color: var(--accent-fill-rest);">@stats.Words</FluentLabel>
                        <FluentLabel Typo="Typography.Body">Kelime</FluentLabel>
                    </FluentCard>
                </FluentGridItem>

                <FluentGridItem xs="12" sm="6" md="4">
                    <FluentCard Style="padding: 16px; background: var(--neutral-layer-2); text-align: center;">
                        <FluentLabel Typo="Typography.H4" Style="color: var(--accent-fill-rest);">@stats.Characters</FluentLabel>
                        <FluentLabel Typo="Typography.Body">Karakter (tüm)</FluentLabel>
                    </FluentCard>
                </FluentGridItem>

                <FluentGridItem xs="12" sm="6" md="4">
                    <FluentCard Style="padding: 16px; background: var(--neutral-layer-2); text-align: center;">
                        <FluentLabel Typo="Typography.H4" Style="color: var(--accent-fill-rest);">@stats.CharactersNoSpaces</FluentLabel>
                        <FluentLabel Typo="Typography.Body">Karakter (boşluksuz)</FluentLabel>
                    </FluentCard>
                </FluentGridItem>

                <FluentGridItem xs="12" sm="6" md="4">
                    <FluentCard Style="padding: 16px; background: var(--neutral-layer-2); text-align: center;">
                        <FluentLabel Typo="Typography.H4" Style="color: var(--accent-fill-rest);">@stats.Bytes</FluentLabel>
                        <FluentLabel Typo="Typography.Body">Byte (UTF-8)</FluentLabel>
                    </FluentCard>
                </FluentGridItem>

                <FluentGridItem xs="12" sm="6" md="4">
                    <FluentCard Style="padding: 16px; background: var(--neutral-layer-2); text-align: center;">
                        <FluentLabel Typo="Typography.H4" Style="color: var(--accent-fill-rest);">@stats.Paragraphs</FluentLabel>
                        <FluentLabel Typo="Typography.Body">Paragraf</FluentLabel>
                    </FluentCard>
                </FluentGridItem>

                <FluentGridItem xs="12" sm="6" md="4">
                    <FluentCard Style="padding: 16px; background: var(--neutral-layer-2); text-align: center;">
                        <FluentLabel Typo="Typography.H4" Style="color: var(--accent-fill-rest);">@stats.Sentences</FluentLabel>
                        <FluentLabel Typo="Typography.Body">Cümle</FluentLabel>
                    </FluentCard>
                </FluentGridItem>

                <FluentGridItem xs="12" sm="6" md="4">
                    <FluentCard Style="padding: 16px; background: var(--neutral-layer-2); text-align: center;">
                        <FluentLabel Typo="Typography.H4" Style="color: var(--accent-fill-rest);">@stats.AvgWordLength</FluentLabel>
                        <FluentLabel Typo="Typography.Body">Ort. Kelime Uzunluğu</FluentLabel>
                    </FluentCard>
                </FluentGridItem>
            </FluentGrid>
        </FluentStack>
    </FluentCard>
</FluentStack>

@code {
    private string inputText = string.Empty;
    private TextStatistics stats = new();

    private void OnInputChanged(ChangeEventArgs e)
    {
        inputText = e.Value?.ToString() ?? string.Empty;
        CalculateStats();
    }

    private void CalculateStats()
    {
        if (string.IsNullOrEmpty(inputText))
        {
            stats = new TextStatistics();
            return;
        }

        var lines = inputText.Split('\n');
        var words = inputText.Split(new[] { ' ', '\n', '\r', '\t' }, StringSplitOptions.RemoveEmptyEntries);
        var sentences = inputText.Split(new[] { '.', '!', '?' }, StringSplitOptions.RemoveEmptyEntries);
        var paragraphs = inputText.Split(new[] { "\n\n", "\r\n\r\n" }, StringSplitOptions.RemoveEmptyEntries);

        stats = new TextStatistics
        {
            Lines = lines.Length,
            NonEmptyLines = lines.Count(l => !string.IsNullOrWhiteSpace(l)),
            Words = words.Length,
            Characters = inputText.Length,
            CharactersNoSpaces = inputText.Count(c => !char.IsWhiteSpace(c)),
            Bytes = System.Text.Encoding.UTF8.GetByteCount(inputText),
            Paragraphs = paragraphs.Length,
            Sentences = sentences.Length,
            AvgWordLength = words.Any() ? Math.Round(words.Average(w => w.Length), 1) : 0
        };
    }

    private class TextStatistics
    {
        public int Lines { get; set; }
        public int NonEmptyLines { get; set; }
        public int Words { get; set; }
        public int Characters { get; set; }
        public int CharactersNoSpaces { get; set; }
        public int Bytes { get; set; }
        public int Paragraphs { get; set; }
        public int Sentences { get; set; }
        public double AvgWordLength { get; set; }
    }
}
