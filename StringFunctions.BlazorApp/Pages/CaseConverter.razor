@page "/case-converter"

<SeoHead Route="case-converter" />
@using System.Globalization

<PageTitle>Case Converter</PageTitle>

<ToolPageLayout Title="Case Converter" Description="Convert text to different case formats.">
    <OptionsContent>
        <div class="option-group">
            <span class="option-label">Convert to:</span>
            <FluentSelect TOption="string" @bind-Value="@caseMode" Style="min-width: 200px;" @bind-Value:after="ProcessCase">
                <FluentOption Value="upper">UPPERCASE</FluentOption>
                <FluentOption Value="lower">lowercase</FluentOption>
                <FluentOption Value="title">Title Case</FluentOption>
                <FluentOption Value="sentence">Sentence case</FluentOption>
                <FluentOption Value="camel">camelCase</FluentOption>
                <FluentOption Value="pascal">PascalCase</FluentOption>
                <FluentOption Value="snake">snake_case</FluentOption>
                <FluentOption Value="kebab">kebab-case</FluentOption>
                <FluentOption Value="constant">CONSTANT_CASE</FluentOption>
                <FluentOption Value="toggle">tOGGLE cASE</FluentOption>
            </FluentSelect>
        </div>
    </OptionsContent>
    <ChildContent>
        <div class="io-grid">
            <div class="io-panel">
                <div class="io-panel-header">
                    <span class="io-panel-title">Input</span>
                </div>
                <FluentTextArea @bind-Value="@inputText" 
                               Placeholder="Enter text..."
                               Resize="TextAreaResize.Vertical"
                               @oninput="OnInputChanged" />
            </div>

            <div class="io-panel">
                <div class="io-panel-header">
                    <span class="io-panel-title">Output</span>
                    <CopyButton Text="@outputText" />
                </div>
                <FluentTextArea Value="@outputText" 
                               ReadOnly="true"
                               Resize="TextAreaResize.Vertical" />
            </div>
        </div>
    </ChildContent>
</ToolPageLayout>

<style>
    .io-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        flex: 1;
    }

    .io-panel {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .io-panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 32px;
    }

    .io-panel-title {
        font-weight: 600;
        color: var(--text-primary);
    }

    @@media (max-width: 768px) {
        .io-grid {
            grid-template-columns: 1fr;
            gap: 16px;
        }
    }
</style>

@code {
    private string inputText = string.Empty;
    private string outputText = string.Empty;
    private string caseMode = "upper";

    private void OnInputChanged(ChangeEventArgs e)
    {
        inputText = e.Value?.ToString() ?? string.Empty;
        ProcessCase();
    }

    private void ProcessCase()
    {
        if (string.IsNullOrEmpty(inputText))
        {
            outputText = string.Empty;
            return;
        }

        outputText = caseMode switch
        {
            "upper" => inputText.ToUpper(),
            "lower" => inputText.ToLower(),
            "title" => CultureInfo.CurrentCulture.TextInfo.ToTitleCase(inputText.ToLower()),
            "sentence" => ToSentenceCase(inputText),
            "camel" => ToCamelCase(inputText),
            "pascal" => ToPascalCase(inputText),
            "snake" => ToSnakeCase(inputText),
            "kebab" => ToKebabCase(inputText),
            "constant" => ToConstantCase(inputText),
            "toggle" => ToggleCase(inputText),
            _ => inputText
        };
    }

    private string ToSentenceCase(string text)
    {
        if (string.IsNullOrEmpty(text)) return text;
        var sentences = text.Split(new[] { ". ", "! ", "? " }, StringSplitOptions.None);
        return string.Join(". ", sentences.Select(s => 
            string.IsNullOrEmpty(s) ? s : char.ToUpper(s[0]) + s.Substring(1).ToLower()));
    }

    private string ToCamelCase(string text)
    {
        var words = SplitIntoWords(text);
        if (!words.Any()) return text;
        return words.First().ToLower() + string.Concat(words.Skip(1).Select(w => 
            char.ToUpper(w[0]) + w.Substring(1).ToLower()));
    }

    private string ToPascalCase(string text)
    {
        var words = SplitIntoWords(text);
        return string.Concat(words.Select(w => char.ToUpper(w[0]) + w.Substring(1).ToLower()));
    }

    private string ToSnakeCase(string text)
    {
        var words = SplitIntoWords(text);
        return string.Join("_", words.Select(w => w.ToLower()));
    }

    private string ToKebabCase(string text)
    {
        var words = SplitIntoWords(text);
        return string.Join("-", words.Select(w => w.ToLower()));
    }

    private string ToConstantCase(string text)
    {
        var words = SplitIntoWords(text);
        return string.Join("_", words.Select(w => w.ToUpper()));
    }

    private string ToggleCase(string text)
    {
        return new string(text.Select(c => char.IsUpper(c) ? char.ToLower(c) : char.ToUpper(c)).ToArray());
    }

    private List<string> SplitIntoWords(string text)
    {
        var words = new List<string>();
        var currentWord = new System.Text.StringBuilder();

        foreach (var c in text)
        {
            if (char.IsLetterOrDigit(c))
            {
                currentWord.Append(c);
            }
            else if (currentWord.Length > 0)
            {
                words.Add(currentWord.ToString());
                currentWord.Clear();
            }
        }

        if (currentWord.Length > 0)
            words.Add(currentWord.ToString());

        return words.Where(w => !string.IsNullOrWhiteSpace(w)).ToList();
    }
}
