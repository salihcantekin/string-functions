@page "/base64"

<SeoHead Route="base64" />
<PageTitle>Base64 Encode/Decode</PageTitle>

<ToolPageLayout Title="Base64 Encode/Decode" Description="Encode strings to Base64 or decode Base64 back to text.">
    <OptionsContent>
        <div class="option-group">
            <span class="option-label">Operation:</span>
            <FluentSelect TOption="string" @bind-Value="@mode" Style="min-width: 180px;" @bind-Value:after="Process">
                <FluentOption Value="encode">Encode (Text → Base64)</FluentOption>
                <FluentOption Value="decode">Decode (Base64 → Text)</FluentOption>
            </FluentSelect>
        </div>
        <div class="option-divider"></div>
        <div class="option-group">
            <span class="option-label">Encoding:</span>
            <FluentSelect TOption="string" @bind-Value="@encoding" Style="min-width: 120px;" @bind-Value:after="Process">
                <FluentOption Value="utf8">UTF-8</FluentOption>
                <FluentOption Value="ascii">ASCII</FluentOption>
                <FluentOption Value="unicode">Unicode</FluentOption>
                <FluentOption Value="utf32">UTF-32</FluentOption>
            </FluentSelect>
        </div>
    </OptionsContent>
    <ChildContent>
        @if (!string.IsNullOrEmpty(errorMessage))
        {
            <FluentMessageBar Title="Error" Intent="MessageIntent.Error" Style="margin-bottom: 8px;">
                @errorMessage
            </FluentMessageBar>
        }

        <div class="io-grid">
            <div class="io-panel">
                <div class="io-panel-header">
                    <span class="io-panel-title">Input</span>
                </div>
                <FluentTextArea @bind-Value="@inputText" 
                               Placeholder="@(mode == "encode" ? "Enter text to encode..." : "Enter Base64 string to decode...")"
                               Resize="TextAreaResize.Vertical"
                               @oninput="OnInputChanged" />
            </div>

            <div class="io-panel">
                <div class="io-panel-header">
                    <span class="io-panel-title">Output</span>
                    <CopyButton Text="@outputText" />
                </div>
                <FluentTextArea Value="@outputText" 
                               ReadOnly="true"
                               Resize="TextAreaResize.Vertical" />
            </div>
        </div>
    </ChildContent>
</ToolPageLayout>

<style>
    .io-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        flex: 1;
    }

    .io-panel {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .io-panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 32px;
    }

    .io-panel-title {
        font-weight: 600;
        color: var(--text-primary);
    }

    @@media (max-width: 768px) {
        .io-grid {
            grid-template-columns: 1fr;
            gap: 16px;
        }
    }
</style>

@code {
    private string inputText = string.Empty;
    private string outputText = string.Empty;
    private string mode = "encode";
    private string encoding = "utf8";
    private string errorMessage = string.Empty;

    private void OnInputChanged(ChangeEventArgs e)
    {
        inputText = e.Value?.ToString() ?? string.Empty;
        Process();
    }

    private void Process()
    {
        errorMessage = string.Empty;
        
        if (string.IsNullOrEmpty(inputText))
        {
            outputText = string.Empty;
            return;
        }

        try
        {
            var enc = encoding switch
            {
                "utf8" => System.Text.Encoding.UTF8,
                "ascii" => System.Text.Encoding.ASCII,
                "unicode" => System.Text.Encoding.Unicode,
                "utf32" => System.Text.Encoding.UTF32,
                _ => System.Text.Encoding.UTF8
            };

            if (mode == "encode")
            {
                var bytes = enc.GetBytes(inputText);
                outputText = Convert.ToBase64String(bytes);
            }
            else
            {
                var bytes = Convert.FromBase64String(inputText);
                outputText = enc.GetString(bytes);
            }
        }
        catch (Exception ex)
        {
            errorMessage = ex.Message;
            outputText = string.Empty;
        }
    }
}
