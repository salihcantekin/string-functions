@page "/base64"

<PageTitle>Base64 Encode/Decode</PageTitle>

<FluentStack Orientation="Orientation.Vertical" Style="gap: 20px;">
    <FluentCard Style="padding: 20px;">
        <FluentLabel Typo="Typography.H3">Base64 Encode/Decode</FluentLabel>
        <FluentLabel Typo="Typography.Body">String'i Base64 formatına kodlayın veya Base64'ten çözün.</FluentLabel>
    </FluentCard>

    <FluentCard Style="padding: 20px;">
        <FluentStack Orientation="Orientation.Vertical" Style="gap: 16px;">
            <FluentLabel Typo="Typography.H5">Ayarlar</FluentLabel>
            
            <FluentSelect TOption="string" @bind-Value="@mode" Label="İşlem" Style="width: 100%;">
                <FluentOption Value="encode">Encode (String → Base64)</FluentOption>
                <FluentOption Value="decode">Decode (Base64 → String)</FluentOption>
            </FluentSelect>
            
            <FluentSelect TOption="string" @bind-Value="@encoding" Label="Karakter Kodlaması" Style="width: 100%;">
                <FluentOption Value="utf8">UTF-8</FluentOption>
                <FluentOption Value="ascii">ASCII</FluentOption>
                <FluentOption Value="unicode">Unicode</FluentOption>
                <FluentOption Value="utf32">UTF-32</FluentOption>
            </FluentSelect>
        </FluentStack>
    </FluentCard>

    <FluentCard Style="padding: 20px;">
        <FluentStack Orientation="Orientation.Vertical" Style="gap: 12px;">
            <FluentLabel Typo="Typography.H5">Giriş</FluentLabel>
            <FluentTextArea @bind-Value="@inputText" 
                           Placeholder="@(mode == "encode" ? "Kodlanacak metni girin..." : "Base64 string'i girin...")"
                           Rows="10"
                           Style="width: 100%;"
                           @oninput="OnInputChanged" />
        </FluentStack>
    </FluentCard>

    @if (!string.IsNullOrEmpty(errorMessage))
    {
        <FluentMessageBar Title="Hata" Intent="MessageIntent.Error">
            @errorMessage
        </FluentMessageBar>
    }

    <FluentCard Style="padding: 20px;">
        <FluentStack Orientation="Orientation.Vertical" Style="gap: 12px;">
            <FluentStack Orientation="Orientation.Horizontal" Style="justify-content: space-between; align-items: center;">
                <FluentLabel Typo="Typography.H5">Çıktı</FluentLabel>
                <FluentButton Appearance="Appearance.Accent" OnClick="CopyToClipboard" Disabled="@string.IsNullOrEmpty(outputText)">
                    Kopyala
                </FluentButton>
            </FluentStack>
            <FluentTextArea Value="@outputText" 
                           ReadOnly="true"
                           Rows="10"
                           Style="width: 100%;" />
        </FluentStack>
    </FluentCard>
</FluentStack>

@code {
    [Inject] private IJSRuntime JSRuntime { get; set; } = default!;
    
    private string inputText = string.Empty;
    private string outputText = string.Empty;
    private string mode = "encode";
    private string encoding = "utf8";
    private string errorMessage = string.Empty;

    private void OnInputChanged(ChangeEventArgs e)
    {
        inputText = e.Value?.ToString() ?? string.Empty;
        Process();
    }


    private void Process()
    {
        errorMessage = string.Empty;
        
        if (string.IsNullOrEmpty(inputText))
        {
            outputText = string.Empty;
            return;
        }

        try
        {
            var enc = encoding switch
            {
                "utf8" => System.Text.Encoding.UTF8,
                "ascii" => System.Text.Encoding.ASCII,
                "unicode" => System.Text.Encoding.Unicode,
                "utf32" => System.Text.Encoding.UTF32,
                _ => System.Text.Encoding.UTF8
            };

            if (mode == "encode")
            {
                var bytes = enc.GetBytes(inputText);
                outputText = Convert.ToBase64String(bytes);
            }
            else
            {
                var bytes = Convert.FromBase64String(inputText);
                outputText = enc.GetString(bytes);
            }
        }
        catch (Exception ex)
        {
            errorMessage = ex.Message;
            outputText = string.Empty;
        }
    }

    private async Task CopyToClipboard()
    {
        await JSRuntime.InvokeVoidAsync("navigator.clipboard.writeText", outputText);
    }
}
